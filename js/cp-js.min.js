jQuery(function(d){var c={$addDiv:d("div#cp-add-container"),$header:d("h2#section-header"),$ajaxLoader:d("img#ajax-loader").hide(),$submit:d("input.cp-submit"),$deleteDiv:d("div#delete-container"),regExURL:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,regExDate:/\d{4}-\d{2}-\d{2}/,loadingGif:'<img src="'+phpvars.plugin_url+'img/ajax-loader.gif" class="loading-gif" alt="loadingâ€¦">',addedFlag:false,editID:0,eventProgVenue:d("div.cp-inside").attr("data-page"),deleteVals:{},numResultsPerPage:+phpvars.numResultsPerPage,eventsToDelete:"",popped:("state" in window.history),initialURL:location.href,pageNo:1,event:{$date:d("input#concert-date"),$endDate:d("input#concert-end-date"),$multiDate:d("input#multi-date"),$hour:d("select#concert-hour"),$min:d("select#concert-min"),$venueSelect:d("select#select-venue"),$progSelect:d("select#select-prog"),$showVenue:d("a#show-venue"),$venueHide:d(".venue-hide"),$showProg:d("a#show-prog"),$progHide:d(".prog-hide")},prog:{$progTitle:d("input#programme-title")},venue:{$venueName:d("input#venue-name"),$venueURL:d("input#venue-url"),$venueAddress:d("input#venue-address")},stripslashes:function(e){e=e.replace(/\\'/g,"'");e=e.replace(/\\"/g,'"');e=e.replace(/\\0/g,"\0");e=e.replace(/\\\\/g,"\\");return e},hideStuff:(function(){if(adminpage==="concertpress_page_events"){d(".venue-hide, .prog-hide").hide()}d("#map-canvas").hide()}()),removeMessageDivs:function(){if(d("div.message").length){d("div.message").remove()}},scrollUp:function(){d("body, html").animate({scrollTop:0},500)},showAddEditDiv:function(f){var e=this,g={scroll:true},f=d.extend(g,f);if(!this.$addDiv.is(":visible")){this.$addDiv.fadeIn(500,function(){if(f.scroll===true){e.scrollUp()}})}else{if(f.scroll===true){e.scrollUp()}}},hideAddEditDiv:function(f){var e=this,g={scroll:true,removeMessages:true},f=d.extend(g,f);d("input.cp-clear").val("");if(adminpage==="concertpress_page_events"){e.event.$venueHide.add(e.event.$progHide).hide();if(e.event.$multiDate.is(":checked")){e.event.$multiDate.attr("checked",false).trigger("change")}e.event.$hour.add(e.event.$min).attr("disabled",false).val(0)}e.event.$showVenue.add(e.event.$showProg).show();if(adminpage==="concertpress_page_events"||adminpage==="concertpress_page_programmes"){tinyMCE.init({height:"300",onitit:function(){tinyMCE.activeEditor.setContent("")}})}e.$addDiv.slideUp(500);if(f.scroll===true){e.scrollUp()}if(f.removeMessages===true){e.removeMessageDivs()}},messageFeedback:function(h){var e=this,f={message:"",type:"updated",callback:""},h=d.extend(f,h),g='<div class="message '+h.type+'">'+h.message+"</div>";e.removeMessageDivs();e.$header.after(g);d(".message").hide().fadeIn(400,function(){e.scrollUp();if(typeof h.callback=="function"){h.callback.call(e)}})},$dialog:d("div#delete-container").dialog({autoOpen:false,modal:true,width:550,resizable:false,buttons:{cancel:function(){d(this).dialog("close");d("select#action").val(0)},"delete":function(){d(this).dialog("close");c.deleteEventProgOrVenue()}},show:"drop"}),reloadAfterAjax:function(f){var h=this,e=f||1,i=d("#cp-table-container").html(h.loadingGif),g=(adminpage==="concertpress_page_archives")?"yes":"no";var j={action:"redraw-tables",page:h.eventProgVenue,pageNo:e,numResults:h.numResultsPerPage,archives:g};var k=d.post(ajaxurl,j,function(l){i.hide().html(l).fadeIn(300);d("select#num-events").val(h.numResultsPerPage)});h.pageNo=e},saveOptions:function(f){var e=this,g={action:"save-options",numResults:f},h=d.post(ajaxurl,g,function(i){e.numResultsPerPage=+i})},datePicker:function(){this.event.$date.add(this.event.$endDate).datepicker({showOn:"both",buttonImage:phpvars.plugin_url+"img/calendar_icon.png",buttonImageOnly:false,dateFormat:"yy-mm-dd",firstDay:1,numberOfMonths:2})},multiDateChange:function(){var e=this,f=d("p.endDate");if(!e.event.$multiDate.is(":checked")){f.hide();e.event.$hour.add(e.event.$min).attr("disabled",false)}e.event.$multiDate.change(function(){f.stop(true,true).fadeToggle(300);if(e.event.$multiDate.is(":checked")){e.event.$hour.add(e.event.$min).attr("disabled",true)}else{e.event.$hour.add(e.event.$min).attr("disabled",false)}})},venueProgSelectChange:function(e){if(e==="venue"){if(c.event.$venueHide.is(":visible")){c.event.$venueHide.fadeOut(200);c.event.$showVenue.fadeIn(300)}}else{if(e==="prog"){if(c.event.$progHide.is(":visible")){c.event.$progHide.fadeOut(300);c.event.$showProg.fadeIn(400)}}}},addNewEventProgOrVenue:function(g){var e=this,f="Add ";e.editFlag="no";e.eventProgVenue=g;e.removeMessageDivs();switch(g){case"event":f+="event";tinyMCE.init({onitit:function(){tinyMCE.activeEditor.setContent("")}});d("form.cp-form select").val(0);d("input#multi-date").attr("checked",false);break;case"prog":f+="programme";tinyMCE.init({onitit:function(){tinyMCE.activeEditor.setContent("")}});break;case"venue":f+="venue";d("#map-canvas").hide();break}e.$submit.val(f);e.showAddEditDiv();d("input.cp-clear").val("");if(g!=="event"){d("input.cp-clear:first").focus()}},history:function(g){var f=!c.popped&&location.href==c.initialURL,e;c.popped=true;if(f===true){}else{if(location.hash===""){e=1}else{e=location.hash.split("=");e=+e[1]}if(e!==c.pageNo){c.reloadAfterAjax(e)}}g.preventDefault()},createMap:function(i){var h=(i.url!=="")?'<p><a href="'+i.url+'">'+i.url+"</a></p>":"",g=new google.maps.LatLng(i.lat,i.lng);var f={zoom:14,center:g,mapTypeId:google.maps.MapTypeId.ROADMAP};var k=new google.maps.Map(document.getElementById("map-canvas"),f);var l='<div id="content"><h2 id="firstHeading" class="firstHeading">'+i.name+'</h2><div id="bodyContent"><p>'+i.address+"</p>"+h+"</div></div>";var j=new google.maps.InfoWindow({content:l});var e=new google.maps.Marker({position:g,map:k,title:name});google.maps.event.addListener(e,"click",function(){j.open(k,e)})}};d(window).bind("popstate",c.history);c.datePicker();c.multiDateChange();d("select.cp-select").change(function(){var e=(d(this).hasClass("select-venue"))?"venue":"prog";c.venueProgSelectChange(e)});d("div.cp-inside").on("click","p#add-p",function(f){var e=d(this).attr("data-type");c.addNewEventProgOrVenue(e);c.button=d(this).clone();d(this).remove();f.preventDefault()});d("input#cancel").click(function(e){c.$header.after(c.button);c.hideAddEditDiv();e.preventDefault()});c.editEvent=function(f){var g=this,e={edit_id:+f.attr("data-event-id"),prog_id:+f.attr("data-prog-id"),venue_id:+f.attr("data-venue-id"),date:f.attr("data-date"),hour:f.attr("data-hour"),min:f.attr("data-min"),multidate:f.attr("data-multidate"),enddate:f.attr("data-enddate")};d("input.cp-clear").val("");g.event.$hour.add(g.event.$min).val(0);g.event.$date.val(e.date);g.event.$endDate.val(e.enddate);if(e.hour!="00"){g.event.$hour.val(e.hour);g.event.$min.val(e.min)}if(e.multidate=="1"){if(!g.event.$multiDate.is("checked")){g.event.$multiDate.attr("checked",true).trigger("change")}}else{if(g.event.$multiDate.is("checked")){g.event.$multiDate.attr("checked",false).trigger("change")}}g.event.$venueSelect.val(e.venue_id);g.event.$progSelect.val(e.prog_id);g.$submit.val("Save changes");g.editFlag="yes";g.removeMessageDivs();g.editID=e.edit_id;g.showAddEditDiv()};d("div#cp-table-container").on("click","a.edit-event",function(e){c.editEvent(d(this));e.preventDefault()});c.copyEvent=function(e){var f=this,g={prog_id:+e.attr("data-prog-id"),venue_id:+e.attr("data-venue-id")};f.event.$venueSelect.val(g.venue_id);f.event.$progSelect.val(g.prog_id);f.$submit.val("Add event");f.editFlag="no";f.removeMessageDivs();f.showAddEditDiv()};d("div#cp-table-container").on("click","a.copy-event",function(e){c.copyEvent(d(this));e.preventDefault()});c.editVenue=function(f){var i=this.stripslashes(f.attr("data-name")),h=f.attr("data-url"),e=f.attr("data-address"),k=+f.attr("data-lat"),g=+f.attr("data-lng");this.editFlag="yes";this.eventProgVenue="venue";this.editID=+f.attr("data-edit-id");this.removeMessageDivs();this.venue.$venueName.val(i);this.venue.$venueURL.val(h);this.venue.$venueAddress.val(e);if(d("#map-canvas").length){d("#map-canvas").remove()}if(k!==0&&g!==0){var j=d('<div id="map-canvas" />');d("#venue-section").append(j);this.createMap({name:i,address:e,url:h,lat:k,lng:g})}this.$submit.val("Save changes");this.showAddEditDiv()};d("div#cp-table-container").on("click","a.edit-venue",function(e){c.editVenue(d(this));e.preventDefault()});c.checkAssociationsProgVenue=function(){var e=this,h={multiple:false},g=d.extend(h,e.deleteVals),f={action:"check-prog-venue-associations",IDs:g.id,eventProgVenue:e.eventProgVenue,_ajax_nonce:phpvars.nonce};e.eventsToDelete="";e.$ajaxLoader.show();var i=d.post(ajaxurl,f,function(k){e.$ajaxLoader.hide();e.eventsToDelete=k;var j="",l;switch(e.eventProgVenue){case"venue":case"venues":l="venue";break;case"prog":case"progs":l="programme";break;case"event":case"events":l="event";break}if(g.multiple===false){if(k.length===0){j+="<p>Are you sure you want to delete the "+l+" <strong>"+c.deleteVals.name+"</strong>?</p>"}else{j+="<p>Are you sure you want to delete the "+l+" <strong>"+c.deleteVals.name+"</strong>?</p>";j+="<p>The "+l+" is associated with one or more events that will also be deleted!</p>"}}else{if(f.IDs.length===1){j+="<p>Are you sure you want to delete this "+l+"?</p>";if(k.length>0){j+="<p>This "+l+" is associated with one or more events that will also be deleted!</p>"}}else{j+="<p>Are you sure you want to delete these "+l+"s?</p>";if(k.length>0){j+="<p>At least one of the "+l+"s is associated with one more events that will also be deleted!</p>"}}}j+="<p><strong>This action cannot be undone!</strong></p>";c.$dialog.html(j).dialog("open")})};c.deleteEventProgOrVenue=function(){var e=this,g=d.extend({multiple:false},e.deleteVals),f={action:"delete-event-prog-venue-ajax",delIDs:g.id,eventProgVenue:e.eventProgVenue,_ajax_nonce:phpvars.nonce};var h=d.post(ajaxurl,f,function(q){var s=0,m=q.length,x=false;for(;s<m;s++){if(q[s]==="error"){x=true;break}}var w,p={type:"updated"};switch(e.eventProgVenue){case"prog":case"progs":w="programme";break;case"event":case"events":w="event";break;case"venue":case"venues":w="venue";break}if(x===false){if(g.multiple===false){p.message="<p>The "+w+" <strong>"+g.name+"</strong> has been deleted.</p>"}else{if(f.delIDs.length>1){p.message="<p>The "+w+"s have been deleted.</p>"}else{p.message="<p>The "+w+" has been deleted.</p>"}}if(e.eventsToDelete.length>0){var r=0,v=e.eventsToDelete.length,o=[];for(;r<v;r++){var u=e.eventsToDelete[r],n=0,y=u.length;for(;n<y;n++){o.push(u[n]["event_id"])}}f.delIDs=o;f.eventProgVenue="event";var t=d.post(ajaxurl,f,function(j){var i=0,k=j.length;for(;i<k;i++){if(j[i]==="error"){x=true;break}}if(x===true){p.message="<p>Sorry, something went wrong. The "+w+"(s) may not have been deleted. Please try again.</p>";p.type="error"}})}}else{p.message="<p>Sorry, something went wrong. The "+w+"(s) may not have been deleted. Please try again.</p>";p.type="error"}e.messageFeedback(p);e.hideAddEditDiv({removeMessages:false});e.$ajaxLoader.hide();e.reloadAfterAjax(e.pageNo);d("input.cp-checkbox-action").attr("checked",false);d("select#action").val(0)})};d("div#cp-table-container").on("click","a.cp-delete",function(f){var e=d(this);c.deleteVals={id:[+e.attr("data-id")],name:c.stripslashes(e.attr("data-name"))};if(adminpage==="concertpress_page_events"||adminpage==="concertpress_page_archives"){html="<p>Are you sure you want to delete this event?</p>";html+="<p><strong>This cannot be undone!</strong></p>";c.$dialog.html(html).dialog("open")}else{c.eventProgVenue=d(this).attr("data-type");c.checkAssociationsProgVenue()}f.preventDefault()});d("div#cp-table-container").on("change","select#action",function(f){if(d(this).val()=="delete"&&d("input.cp-checkbox:checked").length){var e=[];d.each(d("input.cp-checkbox:checked"),function(){e.push(+d(this).val())});c.deleteVals={multiple:true,id:e};if(adminpage==="concertpress_page_events"||adminpage==="concertpress_page_archives"){html="<p>Are you sure you want to delete ";html+=(e.length>1)?"these events?":"this event?";html+="</p>";html+="<p><strong>This cannot be undone!</strong></p>";c.$dialog.html(html).dialog("open")}else{c.checkAssociationsProgVenue()}}});c.submitVenue=function(f){var g=this,n={message:"",type:"error"},m=[];g.addedFlag=false;g.$ajaxLoader.show();if(g.venue.$venueName.val()==""){m.push("<p>You must provide a title for the new venue.</p>");n.callback=function(){g.venue.$venueName.focus()}}if(!g.venue.$venueURL.val()==""&&!g.regExURL.test(g.venue.$venueURL.val())){m.push("<p>The venue URL (the website) seems invalid.</p>");n.callback=function(){g.venue.$venueURL.focus()}}if(m.length){var h=0,e=m.length;for(;h<e;h++){n.message+=m[h]}g.messageFeedback(n);g.$ajaxLoader.hide()}else{var j={action:"new-venue-ajax",editflag:g.editFlag,edit_id:+g.editID,venue:{name:g.venue.$venueName.val(),URL:g.venue.$venueURL.val(),address:g.venue.$venueAddress.val()},_ajax_nonce:phpvars.nonce};var k=d.post(ajaxurl,j,function(i){var l={message:"",type:"error"};switch(i.result){case"exists":l.message="<p>The venue <strong>"+j.venue.name+"</strong> already exists.</p>";l.callback=function(){g.venue.$venueName.val("").focus()};break;case"error":l.message="<p>Sorry, there was an error submitting the venue to the database. Please try again.</p>";break;case 0:l.message="<p>Nothing was changed!</p>";d("input#cancel").trigger("click");break;case 1:l.message="<p>The venue <strong>"+j.venue.name+"</strong> was successfully "+i.addUpdate+".</p>";l.type="updated";d("input.cp-clear").val("");g.addedFlag=true;if(g.editFlag==="yes"){g.hideAddEditDiv({removeMessages:false});if(d("#map-canvas").length){d("#map-canvas").remove()}}g.reloadAfterAjax(g.pageNo);g.editFlag="no";g.editID=0;g.$submit.val("Add venue");break}g.$ajaxLoader.hide();g.messageFeedback(l)})}};d("input#venue-submit").click(function(e){c.submitVenue(d(this));e.preventDefault()});c.editProgramme=function(e){this.removeMessageDivs();this.editFlag="yes";this.eventProgVenue="prog";this.editID=+e.attr("data-edit-id");var g=this.stripslashes(e.attr("data-name")),f=d("td.content-full-"+this.editID).html();this.prog.$progTitle.val(g);if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=false){details=d("#programme-details").val(f)}else{tinyMCE.activeEditor.setContent(f)}tinyMCE.init({onitit:function(){tinyMCE.activeEditor.setContent(f)}});this.$submit.val("Save changes");this.showAddEditDiv()};d("div#cp-table-container").on("click","a.edit-programme",function(e){c.editProgramme(d(this));e.preventDefault()});c.submitEvent=function(f){var g=this,q=[];var m={action:"new-event-ajax",editflag:c.editFlag,edit_id:+c.editID,progSelectFlag:0,venueSelectFlag:0,event:{date:c.event.$date.val(),multidateflag:0},prog:{},venue:{},_ajax_nonce:phpvars.nonce};g.removeMessageDivs();g.$ajaxLoader.show();if(g.event.$date.val()==""){q.push("You must provide a date.")}else{if(!g.regExDate.test(g.event.$date.val())){q.push("The date must be in the format YYYY-MM-DD. For example: 2012-25-12 ")}}if(g.event.$multiDate.is(":checked")){m.event.multidateflag=1;if(g.event.$date.val()!=""&&g.event.$endDate.val()!=""){var o=g.event.$date.val().replace(/-/g,"/"),p=g.event.$endDate.val().replace(/-/g,"/");o=new Date(o);p=new Date(p);if(p<=o){q.push("The end date for the event shoule be later the start date!")}}if(g.event.$endDate.val()==""){q.push("You must provide an end date for multi-day events.")}else{if(!g.regExDate.test(g.event.$endDate.val())){q.push("The end date is not properly formatted. It must be in the format YYYY-MM-DD. For example: 2012-25-12 ")}}}if(g.event.$venueSelect.length){if(g.venue.$venueName.val()==""&&g.event.$venueSelect.val()==""){q.push("Please add or select a venue.")}}else{if(g.venue.$venueName.val()==""){q.push("Please add a venue.")}}if(!g.venue.$venueURL.val()==""&&!g.regExURL.test(c.venue.$venueURL.val())){q.push("There seems to be a problem with the venue URL")}if(g.event.$progSelect.length){if(g.prog.$progTitle.val()==""&&g.event.$progSelect.val()==""){q.push("Please add or select a programme.")}}else{if(g.prog.$progTitle.val()==""){q.push("Please add a programme.")}}var k={message:"<p>There were some errors with the event you're adding</p>",type:"error"};if(q.length){var n=0,j=q.length;k.message+='<ul id="cp-errors-list">';for(;n<j;n++){k.message+="<li>"+q[n]+"</li>"}k.message+="</ul>";g.messageFeedback(k);g.$ajaxLoader.hide()}else{if(m.event.multidateflag===1){m.event.enddate=g.event.$endDate.val()}else{m.event.hour=+g.event.$hour.val();m.event.min=+g.event.$min.val()}if(g.event.$venueSelect.length&&g.event.$venueSelect.val()!=""){m.venueSelectFlag=1;m.venue_select_id=+g.event.$venueSelect.val();m.venue.name=g.event.$venueSelect.find("option:selected").text()}else{m.venue.name=g.venue.$venueName.val();m.venue.URL=g.venue.$venueURL.val();m.venue.address=g.venue.$venueAddress.val()}if(g.event.$progSelect.length&&g.event.$progSelect.val()!=""){m.progSelectFlag=1;m.prog_select_id=+g.event.$progSelect.val();m.prog.title=g.event.$progSelect.find("option:selected").text()}else{m.prog.title=g.prog.$progTitle.val();var e;if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=false){e=d("#programme-details").val()}else{e=tinyMCE.activeEditor.getContent()}m.prog.details=e}var h=d.post(ajaxurl,m,function(l){var u={type:"error",message:""};if(l.prog.result==="error"||l.venue.result==="error"||l.event.result==="error"){u.message+="<p>Sorry! There was an error adding the event to the database. Snap. Please try again.</p>."}else{if(l.prog.result==="exists"&&l.venue.result==="exists"){u.message+="<p>A programme called <strong>"+m.prog.title+"</strong> and a venue called <strong>"+m.venue.name+"</strong> already exist!</p><p>Please select an existing programme or venue from the drop-down menu or add a new programme or venue.</p>";u.callback=function(){c.prog.$progTitle.val("");c.venue.$venueName.val("").focus()}}else{if(l.prog.result==="exists"){u.message+="<p>A programme called <strong>"+m.prog.title+"</strong> already exists.</p><p>Please select an existing programme from the drop-down menu or add a new programme.</p>";u.callback=function(){c.prog.$progTitle.val("").focus()}}else{if(l.venue.result==="exists"){u.message+="<p>The venue <strong>"+m.venue.name+"</strong> already exists.</p><p>Please select an existing venue from the drop-down menu or add a new venue.</p>";u.callback=function(){g.venue.$venueName.val("").focus()}}}}if(l.event.result===1){u.message+="<p>The event: <strong>"+m.prog.title+"</strong> at <strong>"+m.venue.name+"</strong> on <strong>"+l.date+"</strong> was successfully "+l.addUpdate+".</p>";u.type="updated";d("input.cp-clear").val("");if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=false){d("#programme-details").val("")}else{tinyMCE.activeEditor.setContent("")}g.event.$multiDate.attr("checked",false).trigger("change");g.event.$hour.add(g.event.$min).attr("disabled",false).val(0);g.event.$venueSelect.add(g.event.$progSelect).val(0);g.event.$venueHide.add(g.event.$progHide).hide();g.event.$showVenue.add(g.event.$showProg).show();d("p.endDate").hide();if(g.editFlag==="yes"){g.hideAddEditDiv({removeMessages:false})}g.editFlag="no";g.editID=0;g.$submit.val("Add event");g.reloadAfterAjax(g.pageNo);if(m.progSelectFlag===0){var t='<option value="'+l.prog.id+'">'+m.prog.title+"</option>";if(!g.event.$progSelect.length){var r=d("<select />",{id:"select-prog",name:"select-prog","class":"cp-select long select-prog"});r.append('<option value=""> -- select a programme -- </option>').append(t);d("p#select-list-prog-p").prepend(r);d("select#select-prog").after(" &nbsp;<strong>or</strong>&nbsp; ")}else{g.event.$progSelect.append(t)}c.event.$progSelect=d("select#select-prog")}if(m.venueSelectFlag===0){var s='<option value="'+l.venue.id+'">'+m.venue.name+"</option>";if(!g.event.$venueSelect.length){var i=d("<select />",{id:"select-venue",name:"select-venue","class":"cp-venue long select-prog"});i.append('<option value=""> -- select a venue -- </option>').append(s);d("p#select-list-venue-p").prepend(i);d("select#select-venue").after(" &nbsp;<strong>or</strong>&nbsp; ")}else{g.event.$venueSelect.append(s)}c.event.$venueSelect=d("select#select-venue")}}else{if(l.event.result===0){u.message="<p>Nothing was changed</p>";d("input#cancel").trigger("click")}}g.messageFeedback(u)}})}g.$ajaxLoader.hide()};d("input#event-submit").click(function(e){c.submitEvent(d(this));e.preventDefault()});c.event.$showProg.click(function a(e){c.event.$progHide.fadeIn(500).find("input:first").focus();c.event.$progSelect.val(0);d(this).hide();e.preventDefault()});c.event.$showVenue.click(function b(e){c.event.$venueHide.fadeIn(500).find("input:first").focus();c.event.$venueSelect.val(0);d(this).hide();e.preventDefault()});c.submitProgramme=function(e){var f=this,i,k={type:"error"};f.removeMessageDivs();if(f.prog.$progTitle.val()==""){k.message="<p>You must provide a title for the new programme.</p>";k.callback=function(){f.prog.$progTitle.focus()};f.messageFeedback(k)}else{f.$ajaxLoader.show();var g;if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=false){g=d("#programme-details").val()}else{g=tinyMCE.activeEditor.getContent()}var h={action:"new-programme-ajax",editflag:f.editFlag,edit_id:+f.editID,prog:{title:f.prog.$progTitle.val(),details:g},_ajax_nonce:phpvars.nonce};var j=d.post(ajaxurl,h,function(l){switch(l.result){case"exists":k.message="<p>The programme title <strong>"+h.prog.title+"</strong> already exists. Please choose a different title.</p>";k.callback=function(){f.prog.$progTitle.val("").focus()};break;case"error":k.message="<p>Sorry, there was an error submitting the programme to the database. Please try again.</p>";break;case 0:k.message="<p>Nothing was changed!</p>";d("input#cancel").trigger("click");break;case 1:k.message="<p>The programme <strong>"+h.prog.title+"</strong> was successfully "+l.addUpdate+".</p>";k.type="updated";f.reloadAfterAjax(f.pageNo);f.prog.$progTitle.val("");if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=false){d("#programme-details").val("")}else{tinyMCE.activeEditor.setContent("")}f.$submit.val("Add programme");if(f.editFlag=="yes"){f.hideAddEditDiv({removeMessages:false})}f.editFlag="no";f.editID=0;break}f.removeMessageDivs();f.$ajaxLoader.hide();f.messageFeedback(k)})}};d("input#prog-submit").click(function(e){c.submitProgramme(d(this));e.preventDefault()});d("#cp-table-container").on("click","a.page-numbers",function(f){if(!d(this).hasClass("current")){var e=+d(this).attr("data-pageno");history.pushState(null,"Page: "+e,this.href);c.eventProgVenue=d("div#cp-table-container").attr("data-page");c.reloadAfterAjax(e)}f.preventDefault()});if(window.location.hash!==""){d("#cp-table-container").html(c.loadingGif)}d(document).keyup(function(e){if(e.keyCode==27){d("#cancel").click()}});d("div#cp-table-container").on("change","input.cp-checkbox-action:checkbox",function(){if(d(this).is(":checked")){d("input.cp-checkbox, input.cp-checkbox-action").attr("checked",true)}else{d("input.cp-checkbox, input.cp-checkbox-action").attr("checked",false)}});d("div#cp-table-container").on("change","select#num-events",function(f){var e=c.numResultsPerPage=+d("select#num-events option:selected").val(),g=window.location.href.replace(/#[\w=]+/,"");c.saveOptions(e);c.reloadAfterAjax();history.pushState(null,"Page: #1",g)});d("select#num-events").val(c.numResultsPerPage);d("span.checkbox_label").click(function(){$checkBox=d('input[name="multiDate"]');if($checkBox.is(":checked")){$checkBox.attr("checked",false).trigger("change")}else{$checkBox.attr("checked",true).trigger("change")}})});